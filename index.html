<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AyP Importados</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes blob { 0% { transform: translate(0px, 0px) scale(1); } 33% { transform: translate(30px, -50px) scale(1.1); } 66% { transform: translate(-20px, 20px) scale(0.9); } 100% { transform: translate(0px, 0px) scale(1); } }
        .animate-blob { animation: blob 7s infinite; }
        .animation-delay-2000 { animation-delay: 2s; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { display: inline-block; white-space: nowrap; animation: marquee 20s linear infinite; }
        .logo-wrapper { position: relative; overflow: hidden; border-radius: 12px; padding: 5px; }
        .logo-img { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); filter: drop-shadow(0 0 0 rgba(0,0,0,0)); }
        .logo-wrapper:hover .logo-img { filter: drop-shadow(-6px -6px 8px rgba(0, 100, 255, 0.6)) drop-shadow(0px 0px 8px rgba(255, 255, 255, 0.8)) drop-shadow(6px 6px 8px rgba(255, 0, 50, 0.6)); transform: scale(1.1) rotate(2deg); }
        .logo-wrapper::after { content: ''; position: absolute; top: 0; left: -150%; width: 100%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0) 100%); transform: skewX(-25deg); pointer-events: none; }
        .logo-wrapper:hover::after { left: 150%; transition: left 0.7s ease-in-out; }
        .glass-select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23e2e8f0' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.75rem center; background-repeat: no-repeat; background-size: 1.2em 1.2em; padding-right: 2.5rem; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @media print { body * { visibility: hidden; } .ticket-modal, .ticket-modal * { visibility: visible; } .ticket-modal { position: absolute; left: 0; top: 0; width: 100%; background: white !important; color: black !important; } .no-print { display: none !important; } }
    </style>

    <!-- FIREBASE INITIALIZATION MODULE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configuraci√≥n por defecto (fallback)
        const firebaseConfig = {
            apiKey: "AIzaSyBH2NjaLahy6Qshi9TyXoG0keALQL5Zxx0",
            authDomain: "ayp-camisetas.firebaseapp.com",
            projectId: "ayp-camisetas",
            storageBucket: "ayp-camisetas.firebasestorage.app",
            messagingSenderId: "372954593312",
            appId: "1:372954593312:web:7bf9b097ea4b18864de445",
            measurementId: "G-8SQTRX26C3"
        };
        
        // Usar config del entorno si existe
        const configToUse = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : firebaseConfig;
        
        const app = initializeApp(configToUse);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // IMPORTANTE: Usar el ID de app del entorno para las rutas de Firestore
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        window.firebase = { 
            auth, db, signInAnonymously, onAuthStateChanged, signInWithCustomToken,
            collection, doc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, getDocs,
            APP_ID,
            initialToken: typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null
        };
    </script>
</head>
<body class="bg-slate-900 text-slate-100 transition-colors duration-700">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- √çCONOS SVG ---
        const IconBase = ({ children, size = 24, className = "" }) => (<svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        const ShoppingCart = (p) => <IconBase {...p}><circle cx="8" cy="21" r="1" /><circle cx="19" cy="21" r="1" /><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" /></IconBase>;
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></IconBase>;
        const Filter = (p) => <IconBase {...p}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" /></IconBase>;
        const X = (p) => <IconBase {...p}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></IconBase>;
        const MessageCircle = (p) => <IconBase {...p}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" /></IconBase>;
        const ChevronLeft = (p) => <IconBase {...p}><polyline points="15 18 9 12 15 6" /></IconBase>;
        const ChevronRight = (p) => <IconBase {...p}><polyline points="9 18 15 12 9 6" /></IconBase>;
        const Trophy = (p) => <IconBase {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></IconBase>;
        const History = (p) => <IconBase {...p}><path d="M3 3v5h5" /><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8" /></IconBase>;
        const Tag = (p) => <IconBase {...p}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z" /><line x1="7" y1="7" x2="7.01" y2="7" /></IconBase>;
        const Lock = (p) => <IconBase {...p}><rect x="3" y="11" width="18" height="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></IconBase>;
        const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>;
        const AlertTriangle = (p) => <IconBase {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></IconBase>;
        const MenuIcon = (p) => <IconBase {...p}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></IconBase>;
        const Plus = (p) => <IconBase {...p}><path d="M5 12h14" /><path d="M12 5v14" /></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></IconBase>;
        const Edit = (p) => <IconBase {...p}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></IconBase>;
        const Share2 = (p) => <IconBase {...p}><circle cx="18" cy="5" r="3" /><circle cx="6" cy="12" r="3" /><circle cx="18" cy="19" r="3" /><line x1="8.59" y1="13.51" x2="15.42" y2="17.49" /><line x1="15.41" y1="6.51" x2="8.59" y2="10.49" /></IconBase>;
        const Phone = (p) => <IconBase {...p}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" /></IconBase>;
        const Instagram = (p) => <IconBase {...p}><rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" /></IconBase>;
        const LinkIcon = (p) => <IconBase {...p}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></IconBase>;
        const Star = (p) => <IconBase {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></IconBase>;
        const Heart = (p) => <IconBase {...p}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" /></IconBase>;
        const Globe = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></IconBase>;
        const Truck = (p) => <IconBase {...p}><rect x="1" y="3" width="15" height="13" /><polygon points="16 8 20 8 23 11 23 16 16 16 16 8" /><circle cx="5.5" cy="18.5" r="2.5" /><circle cx="18.5" cy="18.5" r="2.5" /></IconBase>;
        const Gift = (p) => <IconBase {...p}><polyline points="20 12 20 22 4 22 4 12" /><rect x="2" y="7" width="20" height="5" /><line x1="12" y1="22" x2="12" y2="7" /><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z" /><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z" /></IconBase>;

        const ICON_MAP = { 'link': LinkIcon, 'whatsapp': Phone, 'instagram': Instagram, 'star': Star, 'heart': Heart, 'globe': Globe, 'truck': Truck, 'gift': Gift };

        // --- DATA INICIAL CONSTANTES ---
        const ADMIN_HASH = "MDYyNzA4";
        const INITIAL_MARQUEE = "‚öΩ ENV√çOS GRATIS A TODO EL PA√çS EN COMPRAS SUPERIORES A $150.000 ‚öΩ  üî• 3 CUOTAS SIN INTER√âS üî•";
        
        const INITIAL_CATEGORIES = [
            { id: 1, name: "Premier League", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgkSAf6I2sP5AuBQq1YxsDh7Dg167gncu5PZwUvDVMXed1QQRyl9JQygpr_Jp5OJZdTrqUbjZWxUpu42nblIK1bFKpCf2t-XoyRJf4MMCVYRA24wAR6iQx78HOtwRSAazGguxHSZWJWmN0/s1600/PL.png" },
            { id: 2, name: "La Liga", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirXlLZ6JGoNTRW4xbsozgyfWK6Px4XVkQ-AOxSeoSOjvB6Uma4rYshen8djk6uIwkgD_KsHJl9d7WD6jCcPvLLPa6DtB25ok9qszZ6EoYPcYL_FiOOjsVQVWrKQsJTy9dT6XGFYOCj1Q412AVMNvXn40SCvw4Q_34Nhu33-XhhlH5P3GMMzle-fBSFg6A/s16000/LaLiga.png" },
            { id: 3, name: "Argentina LPF", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-tqx9482e9g6j0VIodmDN28aglSmHZFOOv2BTiX_A0CABdPrJWS3_WgWQm4cEIqoJmfTy5a0rsGb9b88QzVp-kJf0WYirNZMt1hQFAUi0M_-I1O7T93BmebBI3GfpJf4lGv42vCOar-c/d/LPF.png" },
            { id: 4, name: "World Cup", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjnalN74so4om-iSDLjMukAB_NAFeQvLMEaCBlArWfL_hNClYYZBLpcIuzODwwEvy41KLxlJ_oQhNk1FOPlYq4Gx4Vdhc_DyqAxDLA9QaLiHtSm3yb3qNf8tgmPiGz0CQQAikiOEw4kuiyq082XjcpTngo7Lb5eo2omTxGOvMnyAaOJiFKS9hHIngvux_Q/s16000/2026%20FIFA%20World%20Cup512x.png" },
            { id: 5, name: "Serie A", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhMhcOk43mj3-jSTxhIOK0a5HNGBFcXWfojKWTr0nxlq7H9j9azR_WSXunp7wIG46Oijp1s0Qb9qmtgTkqR686OOPj1PFExA7DXk9E6hO8PAlmFkEYW5hHcsaveO-dWhw4biJgJSBCPVjE5bmcFooTbOXthGNRyypArGLNg-1ITKX8AQEUVsAUGKAWq/s16000/Lega%20Serie%20A%20TIM.png" },
            { id: 6, name: "Brasileirao", image: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjonZaPEY15CvlPFdoSBYmO3yJHjokO9W7aIdCT2wfCPtVU1HJ-XBy01iCEmeA2k0wvl2iFa7cmsBsiSAa1uaV9RAeDPUDSftQGDiYPsi4hUZ1ZpEGA3dnlyjafaXQvD314fmWMNgwqy3VJH-hCsLyJk47jNJ47DxHFsdnG0VhBeluMaJ3e_A_xTxsuA8Q/s16000/Brasileirao%20Betano.png" },
            { id: 7, name: "Ligue 1", image: "https://upload.wikimedia.org/wikipedia/commons/4/49/Ligue1_Uber_Eats_logo.png" }
        ];
        
        const INITIAL_CONTACTS = [
            { id: 1, label: "WhatsApp Mayorista", url: "https://wa.me/5493515604303", type: "whatsapp" },
            { id: 2, label: "Instagram", url: "https://www.instagram.com/ayp_importados/?hl=es", type: "instagram" }
        ];

        const INITIAL_PRODUCTS = [
            { id: 1, name: "Argentina 2025", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Campe√≥n", league: "World Cup", team: "Argentina", type: "Actual", version: "Fan", category: "Selecci√≥n", sizes: ["S", "M", "L", "XL", "XXL"], stock: { "XS": 2, "S": 10, "M": 10, "L": 10, "XL": 5, "XXL": 2, "3XL": 1 }, images: ["https://i.postimg.cc/bNNfKWrw/a-RGENTINA-2025.webp"], tags: ["2025", "Campe√≥n"], description: "Camiseta oficial de la Selecci√≥n Argentina para la temporada 2025. Tecnolog√≠a de absorci√≥n de humedad AEROREADY.", colors: { primary: "bg-sky-200", secondary: "bg-white" } },
            { id: 2, name: "Alemania 2026", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "", league: "World Cup", team: "Alemania", type: "Actual", version: "Fan", category: "Selecci√≥n", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/mZSGpBLh/Alemania-2026.webp"], tags: ["2026"], description: "Camiseta local de Alemania para el Mundial 2026. Dise√±o cl√°sico en blanco y negro.", colors: { primary: "bg-white", secondary: "bg-black" } },
            { id: 3, name: "Boca Retro 1998", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Retro", league: "Argentina LPF", team: "Boca Juniors", type: "Retro", version: "Normal", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 5, "M": 8, "L": 7, "XL": 3, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/wxkd4gqJ/Boca-retro-1998.webp"], tags: ["Retro", "1998"], description: "Edici√≥n retro hist√≥rica de Boca Juniors 1998. Cuello polo y franja amarilla tradicional.", colors: { primary: "bg-blue-800", secondary: "bg-yellow-500" } },
            { id: 4, name: "Boca Titular 2025", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Nuevo", league: "Argentina LPF", team: "Boca Juniors", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL", "XXL"], stock: { "XS": 2, "S": 10, "M": 10, "L": 10, "XL": 5, "XXL": 2, "3XL": 1 }, images: ["https://i.postimg.cc/QNqrYh87/Boca-titular-2025.webp"], tags: ["2025", "Azul y Oro"], description: "Camiseta titular de Boca Juniors temporada 2025.", colors: { primary: "bg-blue-700", secondary: "bg-yellow-500" } },
            { id: 5, name: "Chelsea 2026", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Player Version", league: "Premier League", team: "Chelsea", type: "Actual", version: "Player", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/nccf6grX/CHELSEA-2026.avif"], tags: ["2026", "Blues"], description: "Camiseta Chelsea 2026 versi√≥n jugador. Corte ajustado y tecnolog√≠a de ventilaci√≥n avanzada.", colors: { primary: "bg-blue-600", secondary: "bg-blue-800" } },
            { id: 6, name: "Liverpool Suplente", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Premier League", team: "Liverpool", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/L66Frw5q/LIVERPOOL-SUPLENTE.webp"], tags: ["Suplente"], description: "Segunda equipaci√≥n del Liverpool. Dise√±o moderno y urbano.", colors: { primary: "bg-green-600", secondary: "bg-white" } },
            { id: 7, name: "Milan Titular", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Cl√°sico", league: "Serie A", team: "Milan", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/L66Frw5Y/MILAN-TITULAR.webp"], tags: ["Rossoneri"], description: "Camiseta cl√°sica a rayas rojas y negras del AC Milan.", colors: { primary: "bg-red-600", secondary: "bg-black" } },
            { id: 8, name: "Real Madrid Tercera", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Tercera", league: "La Liga", team: "Real Madrid", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/kXXPkzGt/Real-Madrid-tercera.webp"], tags: ["Tercera"], description: "Tercera equipaci√≥n del Real Madrid. Elegancia y estilo.", colors: { primary: "bg-gray-800", secondary: "bg-yellow-500" } },
            { id: 9, name: "River 2025", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Nuevo", league: "Argentina LPF", team: "River Plate", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/CLLpWX58/River-2025.jpg"], tags: ["2025", "Banda Roja"], description: "Camiseta titular de River Plate 2025. La banda roja tradicional.", colors: { primary: "bg-white", secondary: "bg-red-600" } },
            { id: 10, name: "Corinthians Suplente", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Brasileirao", team: "Corinthians", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/GhhnZVtG/SUPLENTE-CORINTHIANS.webp"], tags: ["Suplente"], description: "Camiseta negra alternativa del Timao.", colors: { primary: "bg-black", secondary: "bg-white" } },
            { id: 11, name: "PSG Suplente", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Suplente", league: "Ligue 1", team: "PSG", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/3JJQPVNp/SUPLENTE-PSG.jpg"], tags: ["Suplente"], description: "Camiseta suplente del Paris Saint-Germain.", colors: { primary: "bg-blue-900", secondary: "bg-red-600" } },
            { id: 12, name: "Barcelona Tercera", price: 45000, originalPrice: 45000, discountPercent: 0, specialDiscountLabel: "Tercera", league: "La Liga", team: "Barcelona", type: "Actual", version: "Fan", category: "Club", sizes: ["S", "M", "L", "XL"], stock: { "XS": 0, "S": 8, "M": 12, "L": 10, "XL": 6, "XXL": 0, "3XL": 0 }, images: ["https://i.postimg.cc/RVVxjyhR/TERCERA-BARCELONA.webp"], tags: ["Tercera"], description: "Tercera camiseta del FC Barcelona. Dise√±o vibrante.", colors: { primary: "bg-teal-500", secondary: "bg-blue-900" } }
        ];

        // --- COMPONENTES AUXILIARES ---
        const Badge = ({ children, color = "blue" }) => {
            const colors = { blue: "bg-blue-500/20 text-blue-200 border-blue-500/30", purple: "bg-purple-500/20 text-purple-200 border-purple-500/30", green: "bg-green-500/20 text-green-200 border-green-500/30", amber: "bg-amber-500/20 text-amber-200 border-amber-500/30", red: "bg-red-500/20 text-red-200 border-red-500/30", gray: "bg-slate-500/20 text-slate-300 border-slate-500/30", pink: "bg-pink-500/20 text-pink-200 border-pink-500/30" };
            return <span className={`px-2 py-0.5 rounded-full text-xs font-medium border ${colors[color]} backdrop-blur-sm`}>{children}</span>;
        };

        const ImageSlider = ({ images, alt }) => {
            const [current, setCurrent] = useState(0);
            if (!images || images.length === 0) return <div className="w-full h-full flex items-center justify-center text-slate-400">Sin Imagen</div>;
            return (
                <div className="relative w-full h-full group">
                    <img src={images[current]} alt={alt} className="w-full h-full object-contain transition-transform duration-500" />
                    {images.length > 1 && (<><button onClick={(e)=>{e.stopPropagation();setCurrent((c)=>(c-1+images.length)%images.length)}} className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 z-20"><ChevronLeft size={20}/></button><button onClick={(e)=>{e.stopPropagation();setCurrent((c)=>(c+1)%images.length)}} className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70 z-20"><ChevronRight size={20}/></button><div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-20">{images.map((_, i) => (<div key={i} className={`w-2 h-2 rounded-full ${i === current ? 'bg-white' : 'bg-white/40'}`} />))}</div></>)}
                </div>
            );
        };

        // Componente para el formulario de datos del comprador
        const BuyerForm = ({ onSubmit, onClose }) => {
            const [formData, setFormData] = useState({ name: "", email: "", whatsapp: "", country: "", province: "" });
            
            const handleSubmit = (e) => {
                e.preventDefault();
                // Validaci√≥n b√°sica
                if (formData.name && formData.whatsapp && formData.country && formData.province) {
                    onSubmit(formData);
                } else {
                    alert("Por favor completa todos los campos obligatorios.");
                }
            };

            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
                    <div className="bg-slate-900 border border-white/20 p-6 rounded-2xl w-full max-w-md shadow-2xl relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><X size={20}/></button>
                        <h3 className="text-xl font-bold text-white mb-6 text-center">Datos del Comprador</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input required placeholder="Nombre Completo *" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} />
                            <input type="email" placeholder="Correo Electr√≥nico" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" value={formData.email} onChange={e=>setFormData({...formData, email: e.target.value})} />
                            <input required placeholder="WhatsApp (con c√≥digo de pa√≠s) *" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" value={formData.whatsapp} onChange={e=>setFormData({...formData, whatsapp: e.target.value})} />
                            <div className="grid grid-cols-2 gap-4">
                                <input required placeholder="Pa√≠s *" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" value={formData.country} onChange={e=>setFormData({...formData, country: e.target.value})} />
                                <input required placeholder="Provincia/Estado *" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" value={formData.province} onChange={e=>setFormData({...formData, province: e.target.value})} />
                            </div>
                            <button type="submit" className="w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl transition-colors">Continuar con el Pedido</button>
                        </form>
                        <p className="text-xs text-slate-500 mt-4 text-center">(*) Campos obligatorios</p>
                    </div>
                </div>
            );
        };

        const TicketView = ({ order, onClose }) => {
            if (!order) return null;
            
            const handleWhatsApp = () => {
                let message = `Hola, mi n√∫mero de orden es #${order.id}. Quiero confirmar mi compra. ‚öΩ\n\n`;
                message += `*DATOS DEL COMPRADOR:*\nNombre: ${order.buyer.name}\nWhatsApp: ${order.buyer.whatsapp}\nEmail: ${order.buyer.email || 'N/A'}\nUbicaci√≥n: ${order.buyer.province}, ${order.buyer.country}\n\n`;
                message += `*PEDIDO:*\n`;
                order.items.forEach(item => { message += `- ${item.name} (${item.version || 'Normal'}) - Talle ${item.size} x${item.qty}\n`; });
                message += `\n*TOTAL A PAGAR: $${order.finalTotal.toLocaleString()}*`;
                window.open(`https://wa.me/5493515604303?text=${encodeURIComponent(message)}`, '_blank');
            };

            const handleDownloadPDF = () => {
                const doc = new jspdf.jsPDF();
                
                // Encabezado
                doc.setFontSize(22);
                doc.setFont("helvetica", "bold");
                doc.text("AyP Importados", 105, 20, null, null, "center");
                doc.setFontSize(12);
                doc.setFont("helvetica", "normal");
                doc.text("Comprobante de Orden de Compra", 105, 28, null, null, "center");
                
                // L√≠nea separadora
                doc.setLineWidth(0.5);
                doc.line(20, 35, 190, 35);

                // Detalles de la Orden
                doc.setFontSize(10);
                doc.text(`Orden #: ${order.id}`, 20, 45);
                doc.text(`Fecha: ${new Date(order.date).toLocaleDateString()} ${new Date(order.date).toLocaleTimeString()}`, 190, 45, null, null, "right");

                // Datos del Comprador
                doc.setFont("helvetica", "bold");
                doc.text("Datos del Comprador:", 20, 55);
                doc.setFont("helvetica", "normal");
                doc.text(`Nombre: ${order.buyer.name}`, 20, 62);
                doc.text(`WhatsApp: ${order.buyer.whatsapp}`, 20, 68);
                doc.text(`Email: ${order.buyer.email || 'N/A'}`, 110, 62);
                doc.text(`Ubicaci√≥n: ${order.buyer.province}, ${order.buyer.country}`, 110, 68);

                // Tabla de Productos
                let y = 85;
                doc.setFont("helvetica", "bold");
                doc.text("Producto", 20, y);
                doc.text("Cant.", 130, y, null, null, "center");
                doc.text("Precio Unit.", 160, y, null, null, "right");
                doc.text("Total", 190, y, null, null, "right");
                doc.line(20, y + 2, 190, y + 2);
                
                y += 10;
                doc.setFont("helvetica", "normal");
                order.items.forEach((item) => {
                    const productName = `${item.name} (${item.version || 'Normal'}) - Talle ${item.size}`;
                    // Dividir texto largo si es necesario
                    const splitTitle = doc.splitTextToSize(productName, 100);
                    doc.text(splitTitle, 20, y);
                    doc.text(`${item.qty}`, 130, y, null, null, "center");
                    doc.text(`$${item.price.toLocaleString()}`, 160, y, null, null, "right");
                    doc.text(`$${(item.price * item.qty).toLocaleString()}`, 190, y, null, null, "right");
                    y += (splitTitle.length * 5) + 5; // Ajustar altura seg√∫n l√≠neas
                });

                // Totales
                y += 5;
                doc.line(20, y, 190, y);
                y += 10;

                if (order.discount > 0) {
                    doc.text(`Subtotal:`, 160, y, null, null, "right");
                    doc.text(`$${order.total.toLocaleString()}`, 190, y, null, null, "right");
                    y += 8;
                    doc.text(`Descuento (${order.discount}%):`, 160, y, null, null, "right");
                    doc.text(`-$${(order.total - order.finalTotal).toLocaleString()}`, 190, y, null, null, "right");
                    y += 8;
                }

                doc.setFont("helvetica", "bold");
                doc.setFontSize(14);
                doc.text(`TOTAL:`, 160, y, null, null, "right");
                doc.text(`$${order.finalTotal.toLocaleString()}`, 190, y, null, null, "right");

                // Pie de p√°gina
                doc.setFontSize(10);
                doc.setFont("helvetica", "normal");
                doc.text("Gracias por tu compra en AyP Importados!", 105, 280, null, null, "center");

                doc.save(`AyP_Orden_${order.id}.pdf`);
            };

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md">
                    <div className="ticket-modal bg-white text-slate-900 w-full max-w-md rounded-lg shadow-2xl overflow-hidden relative font-mono text-sm">
                        <div className="bg-slate-900 text-white p-4 text-center"><h2 className="text-xl font-bold uppercase tracking-widest">AyP Importados</h2><p className="text-xs text-slate-400">Comprobante de Venta</p></div>
                        <div className="p-6 bg-white">
                            <div className="border-b-2 border-dashed border-slate-300 pb-4 mb-4">
                                <p className="flex justify-between"><span>FECHA:</span> <span>{new Date(order.date).toLocaleDateString()}</span></p>
                                <p className="flex justify-between"><span>HORA:</span> <span>{new Date(order.date).toLocaleTimeString()}</span></p>
                                <p className="flex justify-between font-bold text-lg"><span>ORDEN #:</span> <span>{order.id}</span></p>
                            </div>
                            <div className="border-b-2 border-dashed border-slate-300 pb-4 mb-4 text-sm bg-slate-50 p-3 rounded">
                                <p className="font-bold mb-2 uppercase border-b border-slate-200 pb-1">Datos del Comprador:</p>
                                <p><span className="font-semibold">Nombre:</span> {order.buyer.name}</p>
                                <p><span className="font-semibold">WhatsApp:</span> {order.buyer.whatsapp}</p>
                                {order.buyer.email && <p><span className="font-semibold">Email:</span> {order.buyer.email}</p>}
                                <p><span className="font-semibold">Ubicaci√≥n:</span> {order.buyer.province}, {order.buyer.country}</p>
                            </div>
                            <div className="space-y-4 mb-6">{order.items.map((item, i) => (<div key={i} className="flex flex-col border-b border-slate-100 pb-2 last:border-0"><div className="flex justify-between items-start"><span className="font-bold flex-1">{item.name} <span className="text-xs font-normal text-slate-500">({item.version || 'Normal'})</span></span><span className="font-bold">${(item.price * item.qty).toLocaleString()}</span></div><div className="text-xs text-slate-500 flex justify-between"><span>Talle: {item.size} | Cantidad: {item.qty}</span></div></div>))}</div>
                            <div className="border-t-2 border-dashed border-slate-300 pt-4 mb-6">
                                {order.discount > 0 && <div className="flex justify-between text-sm text-slate-500 mb-2"><span>Subtotal</span><span>${order.total.toLocaleString()}</span></div>}
                                {order.discount > 0 && <div className="flex justify-between text-sm text-green-600 mb-2"><span>Descuento ({order.discount}%)</span><span>-${(order.total - order.finalTotal).toLocaleString()}</span></div>}
                                <div className="flex justify-between text-xl font-black mt-2"><span>TOTAL</span><span>${order.finalTotal.toLocaleString()}</span></div>
                            </div>
                            <div className="space-y-2 no-print"><button onClick={handleWhatsApp} className="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors"><MessageCircle size={18} /> Seguir compra por WhatsApp</button><button onClick={handleDownloadPDF} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors"><CheckCircle size={18} /> Descargar PDF</button><button onClick={onClose} className="w-full bg-slate-200 hover:bg-slate-300 text-slate-900 py-3 rounded font-bold flex items-center justify-center gap-2 uppercase transition-colors">Cerrar</button></div>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginModal = ({ isOpen, onClose, onLogin }) => {
            const [password, setPassword] = useState("");
            if (!isOpen) return null;
            const handleSubmit = (e) => { e.preventDefault(); onLogin(password); setPassword(""); };
            return (
                <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
                    <div className="bg-slate-900 border border-white/20 p-6 rounded-2xl w-full max-w-sm shadow-2xl relative">
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><X size={20}/></button>
                        <div className="flex flex-col items-center mb-6"><div className="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center mb-3"><AlertTriangle className="text-red-500" size={24} /></div><h3 className="text-xl font-bold text-white text-center">Acceso Restringido</h3></div>
                        <form onSubmit={handleSubmit} className="space-y-4"><div><label className="block text-xs font-bold text-slate-500 uppercase mb-1">Contrase√±a</label><input autoFocus type="password" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white focus:border-cyan-500 outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={password} onChange={(e) => setPassword(e.target.value)} /></div><button type="submit" className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl">Ingresar</button></form>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ isOpen, onClose, categories, onSelectCategory, activeCategory, contacts }) => (
            <>
                <div className={`fixed inset-0 bg-black/60 backdrop-blur-sm z-50 transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`} onClick={onClose} />
                <div className={`fixed inset-y-0 left-0 w-72 bg-slate-900 border-r border-white/10 z-50 transform transition-transform duration-300 shadow-2xl flex flex-col ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-6 flex justify-between items-center border-b border-white/10"><h2 className="text-xl font-bold text-white">Men√∫</h2><button onClick={onClose}><X /></button></div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-2">
                        <button onClick={()=>{onSelectCategory('Todas');onClose()}} className={`w-full text-left p-3 rounded-xl flex items-center gap-3 ${activeCategory==='Todas'?'bg-cyan-600 text-white':'text-slate-300 hover:bg-white/5'}`}><Trophy size={18}/> Todas</button>
                        {categories.map(c => (
                            <button key={c.id} onClick={()=>{onSelectCategory(c.name);onClose()}} className={`w-full text-left p-3 rounded-xl flex items-center gap-3 border border-transparent ${activeCategory===c.name?'bg-white/10 border-cyan-500':'text-slate-300 hover:bg-white/5'}`}>
                                <img src={c.image} className="w-6 h-6 object-contain" /> {c.name}
                            </button>
                        ))}
                    </div>
                    <div className="p-4 border-t border-white/10 space-y-2">
                        <h3 className="text-xs font-bold text-slate-500 uppercase mb-2">Contacto</h3>
                        {contacts.map(c => {
                            const IconComponent = ICON_MAP[c.type] || LinkIcon;
                            return (
                                <a key={c.id} href={c.url} target="_blank" className="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 text-white transition group">
                                    <IconComponent size={18} className={c.type === 'instagram' ? 'text-pink-500' : c.type === 'whatsapp' ? 'text-green-400' : 'text-blue-400'} />
                                    <span className="flex-1">{c.label}</span>
                                    {c.type === 'instagram' && <span className="text-[10px] bg-blue-600 px-2 py-0.5 rounded text-white group-hover:bg-blue-500">Seguir</span>}
                                </a>
                            );
                        })}
                    </div>
                </div>
            </>
        );

        const AdminPanel = ({ products, setProducts, categories, setCategories, pendingOrders, onDeductStock, contacts, setContacts, coupons, setCoupons, marqueeText, setMarqueeText, showMarquee, setShowMarquee, onClose }) => {
            const [activeTab, setActiveTab] = useState('list');
            const [editProduct, setEditProduct] = useState(null);
            const [formData, setFormData] = useState({ name: "", originalPrice: "45000", discountPercent: 0, specialDiscountLabel: "", league: "", team: "", type: "Actual", version: "Fan", category: "Club", images: "", tags: "", description: "", stockXS:0, stockS: 0, stockM: 0, stockL: 0, stockXL: 0, stockXXL: 0, stock3XL: 0 });
            const [newContact, setNewContact] = useState({ label: "", url: "", type: "link" });

            const createCollage = (imagesArr) => {
                if (imagesArr.length < 4) return null;
                return null; 
            };

            // Cargar producto
            const loadProductToEdit = (p) => {
                setEditProduct(p);
                setFormData({
                    name: p.name, 
                    originalPrice: p.originalPrice || 45000, 
                    discountPercent: p.discountPercent || 0,
                    specialDiscountLabel: p.specialDiscountLabel || "",
                    league: p.league, team: p.team, type: p.type, version: p.version || "Fan", category: p.category,
                    images: p.images.join(', '), tags: p.tags.join(', '), description: p.description || "",
                    stockXS: p.stock['XS']||0, stockS: p.stock['S']||0, stockM: p.stock['M']||0, stockL: p.stock['L']||0, stockXL: p.stock['XL']||0, stockXXL: p.stock['XXL']||0, stock3XL: p.stock['3XL']||0
                });
                setActiveTab('add');
            };

            const handleSubmitProduct = async (e) => {
                e.preventDefault();
                const stockObj = { "XS": parseInt(formData.stockXS), "S": parseInt(formData.stockS), "M": parseInt(formData.stockM), "L": parseInt(formData.stockL), "XL": parseInt(formData.stockXL), "XXL": parseInt(formData.stockXXL), "3XL": parseInt(formData.stock3XL) };
                const tagsArr = formData.tags.split(',').map(t=>t.trim()).filter(t=>t);
                let imagesArr = formData.images.split(',').map(t=>t.trim()).filter(t=>t);
                
                const originalP = parseInt(formData.originalPrice);
                const discountP = parseInt(formData.discountPercent);
                const finalP = originalP - (originalP * discountP / 100);

                const productData = {
                    ...formData,
                    price: finalP,
                    originalPrice: originalP,
                    discountPercent: discountP,
                    specialDiscountLabel: formData.specialDiscountLabel,
                    stock: stockObj,
                    images: imagesArr,
                    tags: tagsArr
                };
                
                try {
                    const { db, APP_ID, collection, doc, addDoc, updateDoc } = window.firebase;
                    const productsRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');

                    if (editProduct) {
                        const pRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', editProduct.id);
                        await updateDoc(pRef, productData);
                        alert("Producto Actualizado");
                        setEditProduct(null);
                    } else {
                        const newP = { ...productData, colors: { primary: "bg-slate-700", secondary: "bg-slate-600" } };
                        await addDoc(productsRef, newP);
                        alert("Producto Creado");
                    }
                    setFormData({ name: "", originalPrice: "45000", discountPercent: 0, specialDiscountLabel: "", league: "", team: "", type: "Actual", version: "Fan", category: "Club", images: "", tags: "", description: "", stockXS:0, stockS: 0, stockM: 0, stockL: 0, stockXL: 0, stockXXL: 0, stock3XL: 0 });
                    setActiveTab('list');
                } catch (err) {
                    console.error("Error saving product:", err);
                    alert("Error guardando producto. Revisa la consola.");
                }
            };

            const handleAddContact = async () => {
                if (newContact.label && newContact.url) {
                    try {
                        const { db, APP_ID, collection, addDoc } = window.firebase;
                        await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'contacts'), newContact);
                        setNewContact({ label: "", url: "", type: "link" });
                    } catch(err) { console.error(err); }
                }
            };

            const handleDelete = async (id, collectionName) => {
                if (confirm('¬øEliminar?')) {
                    try {
                        const { db, APP_ID, doc, deleteDoc } = window.firebase;
                        await deleteDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', collectionName, id));
                    } catch(err) { console.error(err); }
                }
            };

            const downloadXLS = () => {
                const tableBody = products.map(p => `<tr><td>${p.id}</td><td>${p.name}</td><td>${p.price}</td><td>${p.stock['S']}</td><td>${p.stock['M']}</td><td>${p.stock['L']}</td></tr>`).join('');
                const table = `<html xmlns:x="urn:schemas-microsoft-com:office:excel"><body><table><thead><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Stock S</th><th>Stock M</th><th>Stock L</th></tr></thead><tbody>${tableBody}</tbody></table></body></html>`;
                const blob = new Blob([table], { type: 'application/vnd.ms-excel' });
                const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "stock.xls"; link.click();
            };

            return (
                <div className="fixed inset-0 z-50 bg-slate-900 overflow-y-auto">
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-white flex gap-2"><Lock className="text-cyan-400"/> Admin Panel</h2><button onClick={onClose} className="px-4 py-2 bg-slate-800 rounded-lg text-white">Salir</button></div>
                        <div className="flex gap-2 overflow-x-auto pb-4 mb-4">
                            {['list','add','orders','settings'].map(tab => (
                                <button key={tab} onClick={() => setActiveTab(tab)} className={`px-4 py-2 rounded-lg capitalize whitespace-nowrap ${activeTab===tab?'bg-cyan-600 text-white':'bg-slate-800 text-slate-400'}`}>
                                    {tab === 'list' ? 'Stock' : tab === 'add' ? (editProduct ? 'Editar Producto' : 'Nuevo Producto') : tab === 'orders' ? 'Pedidos' : 'Configuraci√≥n'}
                                </button>
                            ))}
                        </div>

                        {activeTab === 'list' && (
                            <div className="bg-slate-800/50 rounded-xl overflow-hidden border border-white/10 p-4">
                                <div className="flex justify-end mb-4"><button onClick={downloadXLS} className="flex items-center gap-2 text-green-400 hover:text-green-300"><Download size={18}/> Descargar XLS</button></div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left text-sm text-slate-300">
                                        <thead className="text-xs uppercase bg-white/5 text-slate-400"><tr><th className="p-3">Producto</th><th className="p-3">Precio</th><th className="p-3">Stock Total</th><th className="p-3">Acciones</th></tr></thead>
                                        <tbody className="divide-y divide-white/5">
                                            {products.map(p => (
                                                <tr key={p.id} className="hover:bg-white/5">
                                                    <td className="p-3 flex items-center gap-3"><img src={p.images[0]} className="w-8 h-8 rounded" /> 
                                                        <div>
                                                            <div className="font-bold">{p.name}</div>
                                                            <div className="text-xs text-slate-500">{p.version}</div>
                                                            {p.discountPercent > 0 && <span className="text-green-400 text-xs">{p.discountPercent}% OFF</span>}
                                                        </div>
                                                    </td>
                                                    <td className="p-3">${p.price.toLocaleString()}</td>
                                                    <td className="p-3">{p.stock ? Object.values(p.stock).reduce((a,b)=>a+b,0) : 0} u.</td>
                                                    <td className="p-3 flex gap-2">
                                                        <button onClick={() => loadProductToEdit(p)} className="p-1 text-blue-400 hover:bg-blue-400/20 rounded"><Edit size={16}/></button>
                                                        <button onClick={() => handleDelete(p.id, 'products')} className="p-1 text-red-400 hover:bg-red-400/20 rounded"><Trash2 size={16}/></button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <form onSubmit={handleSubmitProduct} className="bg-slate-800/50 p-6 rounded-xl border border-white/10 space-y-4 max-w-3xl mx-auto">
                                <h3 className="text-xl font-bold text-white mb-4">{editProduct ? 'Editar Producto' : 'Agregar Nuevo Producto'}</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <input required placeholder="Nombre" className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full" value={formData.name} onChange={e=>setFormData({...formData, name: e.target.value})} />
                                    <div className="flex gap-2">
                                        <div className="w-1/2">
                                            <label className="text-xs text-slate-400 mb-1 block">Precio Base</label>
                                            <input required type="number" className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full" value={formData.originalPrice} onChange={e=>setFormData({...formData, originalPrice: e.target.value})} />
                                        </div>
                                        <div className="w-1/2">
                                            <label className="text-xs text-slate-400 mb-1 block">% Descuento</label>
                                            <input type="number" className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full" value={formData.discountPercent} onChange={e=>setFormData({...formData, discountPercent: e.target.value})} />
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white/5 p-3 rounded text-sm text-slate-300">
                                    Precio Final Calculado: <span className="font-bold text-green-400">${(formData.originalPrice * (1 - formData.discountPercent/100)).toLocaleString()}</span>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <input placeholder="Nombre Descuento Especial (Ej: FINAL CHAMPIONS)" className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full" value={formData.specialDiscountLabel} onChange={e=>setFormData({...formData, specialDiscountLabel: e.target.value})} />
                                    <input placeholder="Etiquetas (coma)" className="bg-slate-900 border border-white/10 rounded p-3 text-white" value={formData.tags} onChange={e=>setFormData({...formData, tags: e.target.value})} />
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    <input placeholder="Equipo" className="bg-slate-900 border border-white/10 rounded p-3 text-white" value={formData.team} onChange={e=>setFormData({...formData, team: e.target.value})} />
                                    <input placeholder="Liga" className="bg-slate-900 border border-white/10 rounded p-3 text-white" value={formData.league} onChange={e=>setFormData({...formData, league: e.target.value})} />
                                    <div>
                                        <select className="w-full bg-slate-900 border border-white/10 rounded p-3 text-white" value={formData.type} onChange={e=>setFormData({...formData, type: e.target.value})}><option value="Actual">Actual</option><option value="Retro">Retro</option></select>
                                    </div>
                                </div>
                                <div>
                                    <label className="text-xs text-slate-400 mb-1 block">Versi√≥n de la Camiseta</label>
                                    <select className="w-full bg-slate-900 border border-white/10 rounded p-3 text-white" value={formData.version} onChange={e=>setFormData({...formData, version: e.target.value})}>
                                        <option value="Normal">Normal</option>
                                        <option value="Fan">Fan (Hinchada)</option>
                                        <option value="Player">Jugador (Match)</option>
                                    </select>
                                </div>
                                <textarea placeholder="Descripci√≥n del producto..." className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full h-24" value={formData.description} onChange={e=>setFormData({...formData, description: e.target.value})}></textarea>
                                <textarea required placeholder="URLs Im√°genes (Separadas por coma)" className="bg-slate-900 border border-white/10 rounded p-3 text-white w-full h-24" value={formData.images} onChange={e=>setFormData({...formData, images: e.target.value})}></textarea>
                                <div>
                                    <label className="text-xs text-slate-400 mb-2 block">Stock por Talle</label>
                                    <div className="grid grid-cols-7 gap-2">
                                        {["XS","S","M","L","XL","XXL","3XL"].map(s => (
                                            <div key={s} className="text-center"><span className="text-[10px] block text-slate-500">{s}</span><input type="number" className="w-full bg-slate-900 border border-white/10 rounded p-1 text-center text-white" value={formData[`stock${s}`]} onChange={e=>setFormData({...formData, [`stock${s}`]: e.target.value})} /></div>
                                        ))}
                                    </div>
                                </div>
                                <button type="submit" className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-xl">{editProduct ? 'Actualizar Producto' : 'Crear Producto'}</button>
                            </form>
                        )}

                        {activeTab === 'orders' && (
                            <div className="bg-slate-800/50 p-6 rounded-xl border border-white/10 space-y-6">
                                <div className="flex gap-4 items-end bg-slate-900 p-4 rounded-lg">
                                    <div className="flex-1">
                                        <label className="text-xs text-slate-400 block mb-1">Ingresar ID de Orden para Procesar</label>
                                        <input id="orderInput" type="number" placeholder="Ej: 123456" className="w-full bg-slate-800 border border-white/20 rounded p-2 text-white" />
                                    </div>
                                    <button onClick={() => onDeductStock(document.getElementById('orderInput').value)} className="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded font-bold">Procesar y Descontar</button>
                                </div>
                                <h3 className="font-bold text-white">Pedidos Pendientes</h3>
                                {pendingOrders.length === 0 ? <p className="text-slate-500">No hay pedidos pendientes.</p> : (
                                    <div className="space-y-2">
                                        {pendingOrders.map(o => (
                                            <div key={o.id} className="p-3 bg-white/5 rounded flex justify-between items-center">
                                                <div>
                                                    <span className="font-mono font-bold text-cyan-400">#{o.id}</span>
                                                    <span className="text-xs text-slate-400 ml-2 text-slate-500">{new Date(o.date).toLocaleDateString()} | {o.buyer.name}</span>
                                                    <div className="text-sm text-white">{o.items.map(i=>`${i.name} (${i.size})`).join(', ')}</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="font-bold text-white">${o.finalTotal.toLocaleString()}</div>
                                                    <button onClick={() => onDeductStock(o.id)} className="text-xs text-green-400 hover:underline">Procesar</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-slate-800/50 p-6 rounded-xl border border-white/10">
                                    <h3 className="font-bold text-white mb-4">Men√∫ Lateral (Botones)</h3>
                                    <div className="space-y-2 mb-4">
                                        {contacts.map((c) => (
                                            <div key={c.id} className="flex gap-2 items-center bg-slate-900 p-2 rounded">
                                                <span className="text-white text-sm flex-1">{c.label} ({c.type})</span>
                                                <button onClick={() => handleDelete(c.id, 'contacts')} className="text-red-400"><Trash2 size={16}/></button>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="space-y-2 border-t border-white/10 pt-2">
                                        <input placeholder="Texto Bot√≥n" className="w-full bg-slate-900 border border-white/10 rounded p-2 text-white text-sm" value={newContact.label} onChange={e=>setNewContact({...newContact, label:e.target.value})} />
                                        <input placeholder="URL Destino" className="w-full bg-slate-900 border border-white/10 rounded p-2 text-white text-sm" value={newContact.url} onChange={e=>setNewContact({...newContact, url:e.target.value})} />
                                        <select className="w-full bg-slate-900 border border-white/10 rounded p-2 text-white text-sm" value={newContact.type} onChange={e=>setNewContact({...newContact, type:e.target.value})}>
                                            <option value="link">Enlace General</option>
                                            <option value="whatsapp">WhatsApp</option>
                                            <option value="instagram">Instagram</option>
                                            <option value="star">Estrella</option>
                                            <option value="heart">Coraz√≥n</option>
                                            <option value="globe">Mundo</option>
                                            <option value="truck">Cami√≥n</option>
                                            <option value="gift">Regalo</option>
                                        </select>
                                        <button onClick={handleAddContact} className="w-full bg-cyan-600 rounded p-2 text-white text-sm font-bold">Agregar Bot√≥n</button>
                                    </div>
                                </div>
                                <div className="space-y-6">
                                    <div className="bg-slate-800/50 p-6 rounded-xl border border-white/10">
                                        <h3 className="font-bold text-white mb-4">Marquesina</h3>
                                        <input className="w-full bg-slate-900 border border-white/10 rounded p-2 text-white" value={marqueeText} onChange={e=>setMarqueeText(e.target.value)} />
                                        <label className="flex items-center gap-2 text-white mt-2"><input type="checkbox" checked={showMarquee} onChange={e=>setShowMarquee(e.target.checked)} /> Mostrar Cartel</label>
                                    </div>
                                    <div className="bg-slate-800/50 p-6 rounded-xl border border-white/10">
                                        <h3 className="font-bold text-white mb-4">Cupones</h3>
                                        <div className="flex gap-2">
                                            <input id="newCouponCode" placeholder="C√≥digo" className="bg-slate-900 border border-white/10 rounded p-2 text-white w-24" />
                                            <input id="newCouponDisc" type="number" placeholder="%" className="bg-slate-900 border border-white/10 rounded p-2 text-white w-16" />
                                            <button onClick={() => {
                                                const code = document.getElementById('newCouponCode').value.toUpperCase();
                                                const disc = parseInt(document.getElementById('newCouponDisc').value);
                                                if(code && disc) { setCoupons([...coupons, {code, discount: disc}]); document.getElementById('newCouponCode').value=''; }
                                            }} className="bg-cyan-600 px-3 rounded text-white"><Plus/></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            // Estados Datos
            const [user, setUser] = useState(null);
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [contacts, setContacts] = useState([]);
            const [marqueeText, setMarqueeText] = useState(INITIAL_MARQUEE);
            const [showMarquee, setShowMarquee] = useState(true);
            const [pendingOrders, setPendingOrders] = useState([]);
            const [coupons, setCoupons] = useState([{code:'NAVIDAD', discount: 10}]);

            // Estados UI
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [searchQuery, setSearchQuery] = useState("");
            const [filters, setFilters] = useState({ league: 'Todas', type: 'Todos', category: 'Todos', size: 'Todos' });
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isAdminOpen, setIsAdminOpen] = useState(false);
            const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
            const [generatedOrder, setGeneratedOrder] = useState(null);
            const [bgColors, setBgColors] = useState({ primary: "bg-purple-600", secondary: "bg-cyan-600" });
            const [modalSize, setModalSize] = useState(null);
            const [couponInput, setCouponInput] = useState("");
            const [appliedDiscount, setAppliedDiscount] = useState(0);
            const [isBuyerFormOpen, setIsBuyerFormOpen] = useState(false);
            const [buyerInfo, setBuyerInfo] = useState(null);

            // AUTH Effect
            useEffect(() => {
                const { auth, onAuthStateChanged, signInAnonymously, initialToken, signInWithCustomToken } = window.firebase;
                
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    if (u) {
                        setUser(u);
                    } else {
                        // Siempre forzar login an√≥nimo para evitar errores con tokens
                        signInAnonymously(auth).catch(err => console.error("Error anon auth", err));
                    }
                });
                return () => unsubscribe();
            }, []);

            // DATA Effect - Solo si hay usuario
            useEffect(() => {
                if (!user) return;

                const { db, collection, addDoc, onSnapshot, APP_ID, getDocs } = window.firebase;

                // Funci√≥n Seed para cargar datos si no existen
                const seedData = async () => {
                    // Check products
                    const productsRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'products');
                    try {
                        const snap = await getDocs(productsRef);
                        if (snap.empty) {
                            console.log("Seeding Database...");
                            INITIAL_PRODUCTS.forEach(p => addDoc(productsRef, p));
                            
                            const catRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'categories');
                            INITIAL_CATEGORIES.forEach(c => addDoc(catRef, c));
                            
                            const contRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'contacts');
                            INITIAL_CONTACTS.forEach(c => addDoc(contRef, c));
                        }
                    } catch (e) {
                        console.error("Error seeding data (permissions?)", e);
                    }
                };
                
                seedData();

                // Listeners con manejo de errores
                const errorHandler = (err) => console.log("Snapshot error (likely permissions, wait for auth):", err.code);

                const unsubProducts = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'products'), (s) => {
                    setProducts(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);
                
                const unsubCategories = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'categories'), (s) => {
                    setCategories(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);
                
                const unsubContacts = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'contacts'), (s) => {
                    setContacts(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);
                
                const unsubOrders = onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'orders'), (s) => {
                    setPendingOrders(s.docs.map(d => ({id: d.id, ...d.data()})));
                }, errorHandler);

                return () => { unsubProducts(); unsubCategories(); unsubContacts(); unsubOrders(); };
            }, [user]);

            // Efecto Fondo y URL
            useEffect(() => {
                if (selectedProduct && selectedProduct.colors) { setBgColors(selectedProduct.colors); } 
                else { setBgColors({ primary: "bg-purple-600", secondary: "bg-cyan-600" }); }
                
                try {
                    if(selectedProduct) { window.history.pushState({}, '', `?producto=${selectedProduct.id}`); } 
                    else { const url = new URL(window.location); url.searchParams.delete('producto'); window.history.pushState({}, '', url); }
                } catch (e) { /* ignore sandbox error */ }
            }, [selectedProduct]);

            const filteredProducts = useMemo(() => {
                return products.filter(p => {
                    const matchesSearch = p.name.toLowerCase().includes(searchQuery.toLowerCase()) || (p.tags && p.tags.some(t => t.toLowerCase().includes(searchQuery.toLowerCase())));
                    const matchesLeague = filters.league === 'Todas' || p.league === filters.league;
                    const matchesType = filters.type === 'Todos' || p.type === filters.type;
                    const matchesCategory = filters.category === 'Todos' || p.category === filters.category;
                    const matchesSize = filters.size === 'Todos' || (p.stock && p.stock[filters.size] > 0);
                    return matchesSearch && matchesLeague && matchesType && matchesCategory && matchesSize;
                });
            }, [products, searchQuery, filters]);

            const addToCart = (product, size) => {
                const existingItem = cart.find(item => item.id === product.id && item.size === size);
                const currentStock = product.stock[size];
                const inCartQty = existingItem ? existingItem.qty : 0;
                if (inCartQty < currentStock) {
                    if (existingItem) { setCart(cart.map(item => item.id === product.id && item.size === size ? { ...item, qty: item.qty + 1 } : item)); } 
                    else { setCart([...cart, { ...product, size, qty: 1 }]); }
                    setIsCartOpen(true);
                    setSelectedProduct(null); 
                    setModalSize(null);
                } else { alert("No hay m√°s stock disponible."); }
            };

            const removeFromCart = (id, size) => setCart(cart.filter(item => !(item.id === id && item.size === size)));
            
            const handleBuyerFormSubmit = (data) => {
                setBuyerInfo(data);
                setIsBuyerFormOpen(false);
                handleCheckout(data);
            };

            const handleCheckout = async (buyerData) => {
                if (cart.length === 0) return;
                const orderId = Math.floor(100000 + Math.random() * 900000);
                const total = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
                const finalTotal = total * (1 - appliedDiscount / 100);
                const newOrder = { 
                    id: orderId, // ID num√©rico para mostrar
                    items: [...cart], 
                    total: total, 
                    discount: appliedDiscount, 
                    finalTotal: finalTotal, 
                    date: new Date().toISOString(), 
                    status: 'Pendiente',
                    buyer: buyerData
                };
                
                try {
                    const { db, APP_ID, collection, addDoc } = window.firebase;
                    // Guardar en Firestore con un ID de documento generado
                    await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'orders'), newOrder);
                    
                    setGeneratedOrder(newOrder); // Mostrar ticket localmente
                    setCart([]);
                    setAppliedDiscount(0);
                    setIsCartOpen(false);
                    setBuyerInfo(null);
                } catch(err) {
                    console.error("Error creating order:", err);
                    alert("Error al crear la orden. Intente nuevamente.");
                }
            };

            const handleLoginSubmit = (password) => {
                if (btoa(password) === ADMIN_HASH) { setIsLoginModalOpen(false); setIsAdminOpen(true); } 
                else { alert("Clave incorrecta."); }
            };

            const handleStockDeduction = async (orderId) => {
                // orderId es el ID num√©rico visible
                const orderDoc = pendingOrders.find(o => o.id === parseInt(orderId));
                if (!orderDoc) { alert("Orden no encontrada en pendientes"); return; }
                
                try {
                    const { db, APP_ID, doc, updateDoc } = window.firebase;
                    
                    // 1. Actualizar Stock de Productos
                    for (const item of orderDoc.items) {
                        const product = products.find(p => p.id === item.id);
                        if (product) {
                            const newStock = { ...product.stock };
                            newStock[item.size] = Math.max(0, newStock[item.size] - item.qty);
                            // Usar el ID del documento Firestore (product.id ya es el ID del doc en nuestra l√≥gica de map)
                            const pRef = doc(db, 'artifacts', APP_ID, 'public', 'data', 'products', product.id); 
                            await updateDoc(pRef, { stock: newStock });
                        }
                    }
                    
                    alert(`Orden #${orderId} procesada y stock descontado.`);
                    
                    // Opcional: Marcar orden como 'Procesada' en BD si tuvieramos ese campo
                    
                } catch(err) {
                    console.error(err);
                    alert("Error al procesar stock.");
                }
            };

            const applyCoupon = () => {
                const coupon = coupons.find(c => c.code === couponInput.toUpperCase());
                if(coupon) { setAppliedDiscount(coupon.discount); alert(`Cup√≥n ${coupon.code} aplicado: ${coupon.discount}% OFF`); }
                else { alert("Cup√≥n inv√°lido"); setAppliedDiscount(0); }
            };

            return (
                <div className="min-h-screen relative overflow-x-hidden pb-10 transition-colors duration-700">
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className={`absolute top-0 left-0 w-[800px] h-[800px] ${bgColors.primary} rounded-full blur-[120px] opacity-40 -translate-x-1/2 -translate-y-1/2 animate-blob transition-colors duration-1000`}></div>
                        <div className={`absolute bottom-0 right-0 w-[800px] h-[800px] ${bgColors.secondary} rounded-full blur-[120px] opacity-40 translate-x-1/2 translate-y-1/2 animate-blob animation-delay-2000 transition-colors duration-1000`}></div>
                    </div>

                    {showMarquee && <div className="bg-gradient-to-r from-cyan-600 to-blue-700 text-white text-xs font-bold py-2 overflow-hidden sticky top-0 z-50 shadow-lg"><div className="animate-marquee">{marqueeText}</div></div>}

                    <nav className="sticky top-0 z-40 border-b border-white/10 bg-slate-900/80 backdrop-blur-xl h-20 transition-all">
                        <div className="max-w-7xl mx-auto px-4 h-full flex items-center justify-between">
                            <div className="flex items-center gap-4 w-1/3">
                                <button onClick={() => setIsSidebarOpen(true)} className="p-2 hover:bg-white/10 rounded-full text-white"><MenuIcon size={24} /></button>
                                <div className="hidden md:block relative group w-full max-w-xs">
                                    <input type="text" placeholder="Buscar..." className="w-full bg-slate-800/50 border border-white/10 rounded-full py-1.5 pl-9 pr-4 text-sm text-white focus:border-cyan-500 outline-none" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                    <Search className="absolute left-3 top-2 text-slate-400" size={14} />
                                </div>
                            </div>
                            <div className="absolute left-1/2 -translate-x-1/2 logo-wrapper cursor-pointer" onClick={() => {window.location.href=window.location.pathname}}>
                                <img src="https://i.postimg.cc/9fx1vwqg/Logo-Ay-P.png" className="h-16 w-auto object-contain logo-img" alt="Logo" />
                            </div>
                            <div className="flex items-center justify-end gap-3 w-1/3">
                                <button className="p-2 text-slate-400 hover:text-white" onClick={() => setIsLoginModalOpen(true)}><Lock size={20} /></button>
                                <button className="relative p-2 text-white hover:bg-white/10 rounded-full" onClick={() => setIsCartOpen(true)}>
                                    <ShoppingCart size={24} />
                                    {cart.length > 0 && <span className="absolute top-0 right-0 w-4 h-4 bg-red-500 text-[10px] flex items-center justify-center rounded-full font-bold">{cart.reduce((a,c)=>a+c.qty,0)}</span>}
                                </button>
                            </div>
                        </div>
                    </nav>

                    <Sidebar isOpen={isSidebarOpen} onClose={() => setIsSidebarOpen(false)} categories={categories} activeCategory={filters.league} onSelectCategory={(c) => setFilters({...filters, league: c})} contacts={contacts} />

                    <main className="relative z-10 max-w-7xl mx-auto px-4 py-8">
                        <div className="mb-8 space-y-4">
                            <div className="flex flex-wrap gap-2 justify-center md:justify-start">
                                <button onClick={() => setFilters({...filters, type: 'Todos'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all ${filters.type==='Todos'?'bg-white text-slate-900':'bg-white/5 text-slate-300 border-white/10'}`}>Todo</button>
                                <button onClick={() => setFilters({...filters, type: 'Actual'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all ${filters.type==='Actual'?'bg-green-500/20 text-green-300 border-green-500/50':'bg-white/5 text-slate-300 border-white/10'}`}>Actual</button>
                                <button onClick={() => setFilters({...filters, type: 'Retro'})} className={`px-4 py-1.5 rounded-full text-sm font-medium border transition-all ${filters.type==='Retro'?'bg-amber-500/20 text-amber-300 border-amber-500/50':'bg-white/5 text-slate-300 border-white/10'}`}>Retro</button>
                            </div>
                            <div className="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
                                <select className="bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-sm text-white glass-select min-w-[140px]" value={filters.league} onChange={e=>setFilters({...filters, league: e.target.value})}><option value="Todas">Todas las Ligas</option>{categories.map(c=><option key={c.id} value={c.name}>{c.name}</option>)}</select>
                                <select className="bg-slate-800 border border-white/10 rounded-lg px-3 py-2 text-sm text-white glass-select min-w-[140px]" value={filters.size} onChange={e=>setFilters({...filters, size: e.target.value})}><option value="Todos">Todos los Talles</option>{["XS","S","M","L","XL","XXL","3XL"].map(s=><option key={s} value={s}>{s}</option>)}</select>
                            </div>
                        </div>

                        {filteredProducts.length === 0 ? <div className="text-center py-20 text-slate-400">No hay productos.</div> : (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                {filteredProducts.map(p => {
                                    const hasStock = p.stock && Object.values(p.stock).some(v => v > 0);
                                    return (
                                        <div key={p.id} className="group bg-slate-800/40 border border-white/5 hover:border-cyan-500/50 rounded-2xl overflow-hidden backdrop-blur-sm transition-all hover:shadow-2xl hover:-translate-y-1 cursor-pointer" onClick={() => setSelectedProduct(p)}>
                                            <div className="relative">
                                                <img src={p.images[0]} className="w-full h-64 object-cover" />
                                                <div className="absolute top-2 left-2 flex flex-col gap-1 items-start">
                                                    {!hasStock && <span className="bg-red-600 text-white text-xs px-2 py-1 rounded font-bold">AGOTADO</span>}
                                                    {p.discountPercent > 0 && <span className="bg-green-500 text-white text-xs px-2 py-1 rounded font-bold">{p.discountPercent}% OFF</span>}
                                                    {p.specialDiscountLabel && <span className="bg-purple-600 text-white text-[10px] px-2 py-1 rounded font-bold uppercase tracking-wider animate-pulse">{p.specialDiscountLabel}</span>}
                                                </div>
                                            </div>
                                            <div className="p-4">
                                                <p className="text-cyan-400 text-xs font-bold uppercase mb-1">{p.league}</p>
                                                <h3 className="text-white font-bold leading-tight mb-2 truncate">{p.name}</h3>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xl font-bold text-white">${p.price.toLocaleString()}</span>
                                                    {p.discountPercent > 0 && <span className="text-sm text-slate-500 line-through">${p.originalPrice.toLocaleString()}</span>}
                                                </div>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        )}
                    </main>

                    {selectedProduct && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setSelectedProduct(null)} />
                            <div className={`relative w-full max-w-4xl bg-gradient-to-br from-[${selectedProduct.colors.primary.replace('bg-', '')}] to-[${selectedProduct.colors.secondary.replace('bg-', '')}] border border-white/10 rounded-3xl overflow-hidden shadow-2xl flex flex-col md:flex-row z-10 backdrop-blur-xl max-h-[90vh]`}>
                                <div className={`absolute inset-0 ${selectedProduct.colors.primary} opacity-90 mix-blend-multiply pointer-events-none`}></div>
                                <div className={`absolute inset-0 ${selectedProduct.colors.secondary} opacity-40 mix-blend-overlay pointer-events-none`}></div>
                                
                                <button onClick={() => setSelectedProduct(null)} className="absolute top-4 right-4 z-20 p-2 bg-black/40 rounded-full text-white hover:bg-white hover:text-black transition"><X size={20}/></button>
                                
                                <div className="w-full md:w-3/5 h-96 md:h-auto relative bg-black/10 flex items-center justify-center p-4 z-10">
                                    <ImageSlider images={selectedProduct.images} alt={selectedProduct.name} />
                                    <button onClick={(e) => {e.stopPropagation(); 
                                        if (navigator.share) { navigator.share({ title: selectedProduct.name, url: window.location.href }).catch(console.error); } 
                                        else { navigator.clipboard.writeText(window.location.href); alert("Link copiado!"); }
                                    }} className="absolute bottom-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-cyan-500 transition"><Share2 size={18} /></button>
                                </div>

                                <div className="w-full md:w-2/5 p-6 md:p-8 flex flex-col overflow-y-auto z-10 bg-black/40 backdrop-blur-md">
                                    <div className="flex flex-wrap gap-2 mb-2">
                                        <Badge color="blue">{selectedProduct.league}</Badge>
                                        <span className="bg-white/20 text-white border border-white/30 px-2 py-0.5 rounded-full text-xs font-bold">{selectedProduct.version}</span>
                                        {selectedProduct.specialDiscountLabel && <span className="bg-purple-600/80 text-white border border-purple-500/30 px-2 py-0.5 rounded-full text-xs font-bold animate-pulse">{selectedProduct.specialDiscountLabel}</span>}
                                    </div>
                                    <h2 className="text-3xl font-bold text-white mb-2 leading-tight drop-shadow-md">{selectedProduct.name}</h2>
                                    
                                    <div className="bg-slate-900/60 p-4 rounded-xl border border-white/10 mb-6 shadow-inner">
                                        <div className="flex items-baseline gap-3">
                                            <span className="text-4xl font-bold text-cyan-400 drop-shadow">${selectedProduct.price.toLocaleString()}</span>
                                            {selectedProduct.discountPercent > 0 && <span className="text-lg text-slate-400 line-through">${selectedProduct.originalPrice.toLocaleString()}</span>}
                                        </div>
                                        {selectedProduct.discountPercent > 0 && <span className="text-green-400 text-sm font-bold mt-1 block">¬°Ahorras un {selectedProduct.discountPercent}%!</span>}
                                    </div>

                                    {selectedProduct.description && (
                                        <p className="text-slate-300 text-sm mb-6 leading-relaxed border-l-2 border-white/20 pl-3">{selectedProduct.description}</p>
                                    )}

                                    <div className="flex-1">
                                        <h4 className="text-sm font-medium text-slate-300 mb-3">Seleccionar Talle</h4>
                                        {Object.values(selectedProduct.stock).some(s => s > 0) ? (
                                            <div className="grid grid-cols-4 gap-2 mb-6">
                                                {selectedProduct.sizes.map(size => {
                                                    const stock = selectedProduct.stock[size] || 0;
                                                    return (
                                                        <button key={size} disabled={stock === 0} 
                                                            onClick={() => setModalSize(size)}
                                                            className={`py-2 rounded-lg text-sm font-bold border transition-all ${stock===0 ? 'opacity-30 cursor-not-allowed border-white/10' : modalSize === size ? 'bg-cyan-500 text-white border-cyan-500 shadow-lg shadow-cyan-500/40' : 'bg-white/10 border-white/20 hover:border-cyan-400 text-white hover:bg-white/20'}`}
                                                        >
                                                            {size}
                                                        </button>
                                                    )
                                                })}
                                            </div>
                                        ) : (
                                            <div className="w-full py-3 bg-red-500/20 border border-red-500/50 text-red-200 text-center rounded-xl font-bold mb-6">üö´ AGOTADO</div>
                                        )}
                                        
                                        <button 
                                            onClick={() => addToCart(selectedProduct, modalSize)}
                                            disabled={!modalSize}
                                            className={`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${modalSize ? 'bg-white text-slate-900 hover:bg-cyan-400 hover:text-white shadow-xl transform active:scale-95' : 'bg-slate-700/50 text-slate-500 cursor-not-allowed'}`}
                                        >
                                            <ShoppingCart size={20} /> Agregar al Carrito
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {isCartOpen && (
                        <div className="fixed inset-0 z-50 flex justify-end">
                            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setIsCartOpen(false)} />
                            <div className="relative w-full max-w-md bg-slate-900 h-full shadow-2xl flex flex-col border-l border-white/10 transform transition-transform">
                                <div className="p-6 border-b border-white/10 flex justify-between items-center"><h2 className="text-xl font-bold text-white flex items-center gap-2"><ShoppingCart /> Tu Pedido</h2><button onClick={() => setIsCartOpen(false)}><X /></button></div>
                                <div className="flex-1 overflow-y-auto p-6 space-y-4">
                                    {cart.length === 0 ? <div className="text-center text-slate-500 mt-10">El carrito est√° vac√≠o.</div> : cart.map((item, i) => (
                                        <div key={i} className="flex gap-4 p-3 bg-white/5 rounded-xl border border-white/5">
                                            <img src={item.images[0]} className="w-16 h-16 rounded-lg object-contain bg-white/5" />
                                            <div className="flex-1">
                                                <h4 className="text-white font-medium">{item.name}</h4>
                                                <p className="text-sm text-slate-400">Talle: {item.size} | x{item.qty}</p>
                                                <p className="text-cyan-400 font-bold">${(item.price * item.qty).toLocaleString()}</p>
                                            </div>
                                            <button onClick={() => removeFromCart(item.id, item.size)} className="text-slate-500 hover:text-red-400"><Trash2 size={18} /></button>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-6 bg-slate-800 border-t border-white/10">
                                    <div className="flex gap-2 mb-4">
                                        <input type="text" placeholder="Cup√≥n de descuento" className="flex-1 bg-slate-900 border border-white/10 rounded-lg px-3 py-2 text-white" value={couponInput} onChange={e => setCouponInput(e.target.value)} />
                                        <button onClick={applyCoupon} className="px-4 bg-white/10 hover:bg-white/20 rounded-lg text-white font-medium">Aplicar</button>
                                    </div>
                                    <div className="flex justify-between items-center mb-4 text-lg font-bold text-white">
                                        <span>Total</span>
                                        <span>${(cart.reduce((a,c)=>a+c.price*c.qty,0) * (1 - appliedDiscount/100)).toLocaleString()}</span>
                                    </div>
                                    <button onClick={() => setIsBuyerFormOpen(true)} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white rounded-xl font-bold flex justify-center gap-2"><CheckCircle /> Confirmar Compra</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <LoginModal isOpen={isLoginModalOpen} onClose={() => setIsLoginModalOpen(false)} onLogin={handleLoginSubmit} />
                    {isBuyerFormOpen && <BuyerForm onSubmit={handleBuyerFormSubmit} onClose={() => setIsBuyerFormOpen(false)} />}
                    {isAdminOpen && <AdminPanel products={products} setProducts={setProducts} categories={categories} setCategories={setCategories} pendingOrders={pendingOrders} onDeductStock={handleStockDeduction} contacts={contacts} setContacts={setContacts} coupons={coupons} setCoupons={setCoupons} marqueeText={marqueeText} setMarqueeText={setMarqueeText} showMarquee={showMarquee} setShowMarquee={setShowMarquee} onClose={() => setIsAdminOpen(false)} />}
                    {generatedOrder && <TicketView order={generatedOrder} onClose={() => setGeneratedOrder(null)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
